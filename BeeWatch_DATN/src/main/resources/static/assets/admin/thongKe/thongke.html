
<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8" />
	<title>Thống kê</title>

	<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
	/>
	<link
			rel="stylesheet"
			href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
	/>
	<link
			rel="stylesheet"
			href="https://use.fontawesome.com/releases/v5.1.1/css/all.css"
	/>
	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
	<style type="text/css">
		.container {
			margin-top: 30px;
		}

		.menten {
			border: 1px solid black;
			/*border-radius: 10px;*/
			width: 300px;
			margin-bottom: 10px;
			margin-left: 30px;
			background-color: #187da5e3;
			font-weight: 800;
		}
		.menten > h4 {
			color: white;
			font-family: serif;
		}

		.title {
			color: black;
			margin-left: 10px;
		}

		.mount {
			color: #d21217;
			margin-left: 20px;
			font-weight: 600;
		}

		.selectNam {
			width: 120px;
			height: 20px;
			margin-left: 10px;
		}

		.image img {
			height: 100px;
			width: 150px;
		}

		.nameDh > h6 {
			margin: 5px 5px 5px 5px;
			color: orange;
		}

		.amount > h6 {
			width: 160px;
		}

		.khung {
			margin-left: 10px;
		}
	</style>
</head>
<body>
<div class="container">
	<!-- Nav tabs -->
	<div class="col-sm-3">
		<h3 class="page-title" style="width: 350px">Thống kê </h3>
	</div>
	<ul class="nav nav-tabs" role="tablist">
		<li class="nav-item"><a class="nav-link active"
								data-toggle="tab" data-target="#home" href="">Đơn hàng</a></li>
		<li class="nav-item"><a class="nav-link " data-toggle="tab"
								data-target="#menu1" href="" ng-click="reset1()">Doanh thu</a></li>
	</ul>

	<!-- Tab panes -->
	<div class="tab-content card">
		<div id="home" class="container tab-pane active">
			<div class="content container-fluid">
				<!-- Page Header -->
				<div class="page-header">
					<div class="row align-items-center">

						<div class="row">
							<div class="col-sm-4">
								<div class="menten text-center">
									<h4 class="title">Tổng Đơn Hàng</h4>
									<h3 class="mount">{{total2}} đơn hàng</h3>
								</div>
							</div>

							<div class="col-sm-4">
								<div class="menten text-center">
									<h4 class="title">Đơn Chờ Duyệt</h4>
									<h3 class="mount">{{choDuyet}} đơn hàng</h3>
								</div>
							</div>

							<div class="col-sm-4">
								<div class="menten text-center">
									<h4 class="title">Đơn Đang Xử Lý</h4>
									<h3 class="mount">{{dangXuLy}} đơn hàng</h3>
								</div>
							</div>
						</div>

						<div class="row">
							<div class="col-sm-4">
								<div class="menten text-center">
									<h4 class="title">Đơn Đang Giao</h4>
									<h3 class="mount">{{dangGiao}} đơn hàng</h3>
								</div>
							</div>

							<div class="col-sm-4">
								<div class="menten text-center">
									<h4 class="title">Đã Hoàn Thành</h4>
									<h3 class="mount">{{hoanThanh}} đơn hàng</h3>
								</div>
							</div>

							<div class="col-sm-4">
								<div class="menten text-center">
									<h4 class="title">Đơn Hủy</h4>
									<h3 class="mount">{{daHuy}} đơn hàng</h3>
								</div>
							</div>
						</div>
						<!-- <div class="col-sm-9 d-flex " style="justify-content: flex-end;">
                            <a class="fas fa-file-download" type="Button"> <span class="glyphicon glyphicon-plus"></span>Xuất dữ liệu</a>
                        </div> -->
					</div>
				</div>
				<hr>
				<!-- Search Filter -->
				<div class="row filter-row breadcrumb">
					<div class="col-sm-4">
						<div class="input-group">
							<input type="text" class="form-control" placeholder="Tìm đơn hàng theo tên tài khoản"
								   id="tenTk" name= "tenTk" th:value="${tenTk}">
						</div>
					</div>
					<div id="date-picker-example" class="md-form md-outline input-with-post-icon datepicker">
						<div class="input-group">
							<input type="date" class="form-control" placeholder="Search this blog"
								   id="ngayTk" name= "ngayTk" th:value="${ngayTk}" onblur="checkDateHtai('ngayTk')">
						</div>
					</div>
					<div class="col-sm-6 col-md-3 col-lg-3 col-xl-2 col-12">
						<div class="select-focus">
							<select class="form-control" id="tthaiTk" name= "tthaiTk" th:value="${tthaiTk}">
								<option value=""> -- Trạng thái -- </option>
								<option value="1"> Chờ duyệt </option>
								<option value="2"> Đang xử lý </option>
								<option value="3"> Đang giao </option>
								<option value="4"> Hoàn thành </option>
								<option value="5"> Yêu cầu hoàn</option>
								<option value="6"> Đơn hoàn </option>
								<option value="0"> Đã hủy </option>
							</select>
						</div>
					</div>
					<div class="input-group-append">
						<input class="btn btn-success" type="button" ng-click="timKiemDh(item)" value="Tìm kiếm"/>
					</div>

				</div>
				<hr>
				<!-- /Search Filter -->
				<div class="row">
					<div class="col-md-12">
						<div class="table-responsive">
							<table class="table table-striped custom-table datatable text-center">
								<thead>
								<tr>
									<th style="min-width:50px;">Mã</th>
									<th style="min-width:100px;">Người nhận</th>
									<th style="min-width:100px;">Voucher</th>
									<th style="min-width:100px;">Ngày mua</th>
									<th style="min-width:100px;">Tổng tiền</th>
									<th style="min-width:150px;">Địa chỉ</th>
									<th style="max-width:120px;">Trạng thái</th>
									<th style="max-width:150px;">Hành động</th>
								</tr>
								</thead>
								<tbody>
								<tr ng-repeat="item in pager.items">
									<td>{{item.orderId}}</td>
									<td>{{item.tenNn}}</td>
									<td>{{item.voucher.voucherName}}</td>
									<td>{{item.createDate | date : 'dd-MM-yyyy'}}</td>
									<td>{{item.total | number:0 }} VND</td>
									<td>{{item.address}}</td>
									<td>
										<!-- <span class="mode mode_on">{{item.status}}</span>-->
										<span ng-if="item.status ==1">Chờ duyệt</span>
										<span ng-if="item.status ==2">Đang xử lý</span>
										<span ng-if="item.status ==3">Đang giao</span>
										<span ng-if="item.status ==4">Hoàn thành</span>
										<span ng-if="item.status ==5">Yêu cầu hoàn đơn</span>
										<span ng-if="item.status ==6">Đơn hoàn</span>
										<span ng-if="item.status ==0">Đã hủy</span> |
										<span ng-if="item.tthaiThanhToan == 0"  ng-show="item.status !=6">Chờ thanh toán</span>
										<span ng-if="item.tthaiThanhToan == 1" ng-show="item.status !=6">Đã thanh toán</span>
										<span ng-if="item.tthaiThanhToan == 2" ng-show="item.status !=6">Đã hoàn tiền</span>
									</td>
									<td class="text-nowrap">
										<!--  	<div class="btn-group mt-3" >
                                                <a class="dropdown_icon" data-toggle="dropdown" ng-click="updateDown(item)">
                                                    <button class="fas fa-reply"  ng-disabled="item.status != 1"></button> </a>
                                            </div>
                                            <div class="btn-group mt-3">
                                                <a class="dropdown_icon" data-toggle="dropdown">
                                                    <button class="fas fa-share" ng-click="updateUp(item)"  ng-disabled="item.status ==0 || item.status ==3 "></button>
                                                </a>
                                            </div>
                                            <br>
                                            <div class="btn-group">
                                                <a class="dropdown_icon" data-toggle="modal" data-target="#exampleModal">
                                                    <button type="button" class="fas fa-eye" ng-click="findId(item)"></button>
                                                </a>
                                            </div>
                                            <div class="btn-group">
                                                <a class="dropdown_icon" data-toggle="dropdown">
                                                    <button class="far fa-times-circle" ng-click="updateClose(item)"  ng-disabled="item.status !=1"></button>
                                                </a>
                                            </div>-->
										<div class="btn-group">
											<a class="dropdown_icon" data-toggle="dropdown">
												<button type="button" class="btn btn-primary" ng-show="item.status ==1" ng-click="updateUp(item)">Duyệt đơn</button>
												<button type="button" class="btn btn-primary" ng-show="item.status ==5" ng-click="confirmRefund(item)">Xác nhận hoàn đơn</button>
												<button type="button" class="btn btn-primary" ng-show="item.status ==2" ng-click="updateUp(item)">Giao hàng</button>
												<button type="button" class="btn btn-primary" ng-show="item.status ==3" ng-click="updateUp(item)">Hoàn thành</button>
											</a>
										</div>
										<div class="btn-group">
											<a class="dropdown_icon" data-toggle="dropdown">
												<button class="btn btn-danger" ng-show="item.status !=5"  ng-click="updateClose(item)" ng-disabled="item.status == 4 || item.status ==0 ||item.status ==5 ||item.status ==6">Huỷ đơn</button>
												<button class="btn btn-danger" ng-show="item.status ==5"  ng-click="sayByeRefund(item)" >Từ chối</button>
											</a>
										</div>
										<div class="btn-group">
											<a class="dropdown_icon" data-toggle="modal" data-target="#exampleModal">
												<button class="btn btn-success" ng-click="findId(item)">Chi tiết</button>
											</a>
										</div>
									</td>
								</tr>
								</tbody>
							</table>

							<div class=" text-center mb-3">
								<button class="btn btn-danger" ng-click="pager.first()">
									<b class="fa-solid fa-backward"></b>
								</button>
								<button class="btn btn-primary" ng-click="pager.prev()">
									<b class="fa-sharp fa-solid fa-arrow-left"></b>
								</button>

								<button class="btn btn-success">{{pager.page + 1}} of
									{{pager.count}}</button>

								<button class="btn btn-primary" ng-click="pager.next()">
									<b class="fa-sharp fa-solid fa-arrow-right"></b>
								</button>
								<button class="btn btn-danger" ng-click="pager.last()">
									<i class="fa-solid fa-forward"></i>
								</button>
							</div>
							<!-- Button trigger modal -->
							<!-- Modal -->
							<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
								<div class="modal-dialog modal-lg" role="document">
									<div class="modal-content">
										<div class="modal-header">
											<h5 class="modal-title" id="exampleModalLongTitle">CHI TIẾT HÓA ĐƠN</h5>
										</div>
										<div class="modal-body">
											<table class="table text-center">
												<thead class="thead-info">
												<tr>
													<th scope="col">ID</th>
													<th scope="col">MÃ SẢN PHẨM</th>
													<th scope="col">ĐƠN GIÁ</th>
													<th scope="col">SỐ LƯỢNG</th>
													<th scope="col">THÀNH TIỀN</th>
												</tr>
												</thead>
												<tbody>
												<tr ng-repeat="item in orderDetail">
													<td>{{item.product.productId}}</td>
													<td>{{item.product.name}}</td>
													<td>
														{{item.price |number:0}} VNĐ
													</td>
													<td> {{item.quantity}}</td>
													<td>
														{{item.quantity * item.price |number:0}} VNĐ
													</td>
												</tr>
												</tbody>
											</table>
										</div>
										<div class="modal-footer">
											<button type="button" class="btn btn-secondary" data-dismiss="modal">Thoát</button>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>

			</div>

		</div>

		<div id="menu1" class="container tab-pane">

			<div class="container">
				<div class="row">
					<div class="col-sm-4">
						<div class="menten text-center">
							<h4 class="title">Tổng Doanh Thu</h4>
							<h3 class="mount">{{total}} VND</h3>
						</div>
					</div>

					<div class="col-sm-4">
						<div class="menten text-center">
							<h4 class="title">Số lượng khách đã mua</h4>
							<h3 class="mount">{{account}}</h3>
						</div>
					</div>

					<div class="col-sm-4">
						<div class="menten text-center">
							<h4 class="title">Tổng đơn hàng</h4>
							<h3 class="mount">{{order}}</h3>
						</div>
					</div>
				</div>

				<hr />
				<div class="row">
					<div class="col-sm-4">
						<h4 class="title">Thống kê doanh thu theo năm</h4>
					</div>

					<div class="col-sm-2 input-group-sm mb-3">
						<h5 class="title">Tháng/năm:</h5>
						<input
								type="text"
								id="namTke"
								name="namTke"
								value="{{namTke}}"
								class="form-control"
								placeholder="Nhập tháng năm!"
								style="width: 120px"
								ng-blur="checkKyThangInput('namTke');"
						/>
					</div>
					<div class="form-group col-sm-2">
						<h5 class="title">Loại đồng hồ:</h5>
						<select
								ng-model="formProduct.category.categoryId"
								id="categoySelect"
								class="form-control form-control-sm"
						>
							<option value="">-- Chọn --</option>
							<option ng-repeat="c in cates" ng-value="c.categoryId">
								{{c.name}}
							</option>
						</select>
					</div>
					<div class="form-group col-sm-2">
						<h5 class="title">Hãng:</h5>
						<select
								ng-model="formProduct.brand.brandId"
								id="brandSelect"
								class="form-control form-control-sm"
						>
							<option value="">-- Chọn --</option>
							<option ng-repeat="c in brand" ng-value="c.brandId">
								{{c.name}}
							</option>
						</select>
					</div>
					<div class="form-group col-sm-2">
						<h5 class="title">&emsp;&emsp;&emsp;</h5>
						<input
								type="button"
								style="width: 90px; margin-left: 10px; height: 31px"
								value="Tìm kiếm"
								ng-click="searchdThu();"
								class="btn btn-info"
						/>
					</div>
				</div>
				<div>
					<div class="col-sm-12">
						<table class="table table-hover">
							<thead>
							<tr>
								<th scope="col">Mã sản phẩm</th>
								<th scope="col">Tên sản phẩm</th>
								<th scope="col">Loại đồng hồ</th>
								<th scope="col">Hãng đồng hồ</th>
								<th scope="col">Số lượng mua</th>
								<th scope="col">Tổng tiền</th>
							</tr>
							</thead>
							<tbody>
							<tr ng-repeat="item in pager.itemsProduct">
								<td>{{item.id}}</td>
								<td>{{item.name}}</td>
								<td>{{item.brand}}</td>
								<td>{{item.cate}}</td>
								<td>{{item.quantity}}</td>
								<td>{{item.total}} VND</td>
							</tr>
							</tbody>
						</table>
					</div>
					<div align="right">
						<button class="btn btn-danger" ng-click="pager.first()">
							<b class="fa-solid fa-backward"></b>
						</button>
						<button class="btn btn-primary" ng-click="pager.prev()">
							<b class="fa-sharp fa-solid fa-arrow-left"></b>
						</button>

						<button class="btn btn-success">
							{{pager.page + 1}} of {{pager.count}}
						</button>

						<button class="btn btn-primary" ng-click="pager.next()">
							<b class="fa-sharp fa-solid fa-arrow-right"></b>
						</button>
						<button class="btn btn-danger" ng-click="pager.last()">
							<i class="fa-solid fa-forward"></i>
						</button>
					</div>
				</div>

				<div class="">
					<h4 class="title">Top sản phẩm được mua nhiều nhất</h4>
					<div class="row">
						<div class="col-sm-4" ng-repeat="item in product">
							<div class="khung">
								<div class="image">
									<img alt="" src="/assets/images/{{item.image}}" />
								</div>
								<div class="nameDh">
									<h6>{{item.name}}</h6>

									<div class="amount">
										<h6>{{item.price}} VND</h6>
									</div>
								</div>
							</div>
						</div>
					</div>
					<h4 class="title" style="margin-top: 10px">
						Top tài khoản mua nhiều nhất
					</h4>
					<div class="row">
						<div class="col-sm-4" ng-repeat="item in accountTop">
							<div class="khung">
								<div class="image">
									<img alt="" src="/assets/images/{{item.image}}" />
								</div>
								<div class="nameDh">
									<h6>{{item.fullname}}</h6>

									<div class="amount">
										<h6>Số lần mua hàng: {{item.totalOrder}}</h6>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>
</html>


